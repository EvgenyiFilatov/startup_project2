{% extends "base.html" %}

{% block title %}Стартапы{% endblock %}

{% block content %}
<h2>Мои стартапы</h2>
{% for item in startups %}
<div class="card shadow-sm border-0 rounded-4 p-2 mb-2">
    <div class="card-body text-center py-1">
        <li class="list-group-item px-2 py-1" style="margin-bottom: 4px;">
            <a href="{% url 'startup:startup_detail' item.startup.pk %}"
                class="btn btn-outline-primary btn-sm w-100"
                style="border-radius: 1.2rem; font-size: 1.15rem; padding: 0.45rem 0.5rem;">
                <strong>{{ item.startup.name }}</strong>
            </a>
        </li>
    </div>
</div>
{% empty %}
    <li class="list-group-item">Пока нет стартапов.</li>
{% endfor %}
{% include "paginator.html" %}

<h3>Создать Стартап</h3>
<div class="card shadow-lg border-0 rounded-4 p-4 mb-4" style="max-width: 600px;">
  <div class="card-body">
    <form method="post">
      {% csrf_token %}
      {{ form.as_p }}
      <h4>Разработчики и их роль</h4>
  {{ formset.management_form }}

    <div id="formset-area">
        {% if formset.non_form_errors %}
            <div class="alert alert-danger">
                {% for error in formset.non_form_errors %}
                    <div>{{ error }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% for f in formset %}
        
        <div style="margin-bottom:15px;padding:10px;border:1px solid #ccc;" class="formset-form">
            {{ f.as_p }}
        </div>
    {% endfor %}
    </div>
    <div id="empty-form-template" style="display:none;">
        <div style="margin-bottom:15px;padding:10px;border:1px solid #ccc;" class="formset-form">
            {{ formset.empty_form.as_p|safe }}
        </div>
    </div>

    <button type="button" id="add-form" class="btn btn-outline-success" style="margin-bottom: 20px;">Добавить разработчика</button>
    <br>
    <button type="submit" class="btn btn-primary">Создать стартап</button>
   
</form>

<script>
let formsetArea = document.getElementById('formset-area');
let totalForms = document.getElementById('id_startupdeveloper_set-TOTAL_FORMS');
let addFormBtn = document.getElementById('add-form');
let emptyFormTemplate = document.getElementById('empty-form-template').innerHTML;

addFormBtn.addEventListener('click', function() {
    let formCount = parseInt(totalForms.value);
    let newFormHtml = emptyFormTemplate.replace(/__prefix__/g, formCount);

    formsetArea.insertAdjacentHTML('beforeend', newFormHtml);

    totalForms.value = formCount + 1;
});
</script>
     
{% endblock %}